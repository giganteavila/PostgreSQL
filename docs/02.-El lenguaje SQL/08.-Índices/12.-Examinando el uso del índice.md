Aunque los índices de PostgreSQL no necesitan mantenimiento o sintonía, todavía es importante comprobar  qué índices son realmente utilizados por la carga de trabajo de la  consulta de la vida real. Examinando el uso del índice para una consulta individual se hace con el comando [EXPLAIN;](https://www.postgresql.org/docs/current/sql-explain.html) su aplicación para este propósito se ilustra en [la Sección 14](https://www.postgresql.org/docs/current/using-explain.html).1. También es posible recopilar estadísticas generales sobre el uso de  índices en un servidor en ejecución, como se describe en [la Sección 28](https://www.postgresql.org/docs/current/monitoring-stats.html).2.

Es difícil formular un procedimiento general para determinar qué  índices crear. Hay una serie de casos típicos que se han mostrado en los ejemplos a lo largo de las secciones anteriores. Una buena  experimentación es a menudo necesaria. El resto de esta sección da  algunos consejos para eso:

- Siempre ejecute [ANALYZE](https://www.postgresql.org/docs/current/sql-analyze.html) primero. Este comando recoge estadísticas sobre la distribución de los  valores en la tabla. Esta información es necesaria para estimar el  número de filas devueltas por una consulta, que es necesaria por el  planificador para asignar costos realistas a cada posible plan de  consulta. A falta de estadísticas reales, se asumen algunos valores por  defecto, que casi seguramente son inexactos. Examinando el uso del  índice de una aplicación sin haber corrido  `ANALYZE`Es, por tanto, una causa perdida. Véanse [los](https://www.postgresql.org/docs/current/routine-vacuuming.html#VACUUM-FOR-STATISTICS) artículos [25.1.3](https://www.postgresql.org/docs/current/routine-vacuuming.html#VACUUM-FOR-STATISTICS) y  para más información.

- Utilíce datos reales para la experimentación. El uso de datos de prueba para configurar los índices le dirá qué índices necesita para los datos de prueba, pero eso es todo.

  Es especialmente fatal utilizar conjuntos de datos de prueba  muy pequeños. Si bien seleccionar 1000 de 100000 filas podría ser un  candidato para un índice, seleccionar 1 de 100 filas difícilmente será,  porque las 100 filas probablemente encajen dentro de una sola página de  disco, y no hay ningún plan que pueda vencer secuencialmente la página  de 1 disco.

  También tenga cuidado al inventar los datos de las pruebas,  que a menudo son inevitables cuando la aplicación aún no está en  producción. Los valores que son muy similares, completamente aleatorios o insertados en orden ordenado sesgarán las estadísticas lejos de la  distribución que los datos reales tendrían.

- Cuando los índices no se utilizan, puede ser útil para las  pruebas para forzar su uso. Hay parámetros de tiempo de ejecución que  pueden apagar varios tipos de plan (ver [sección 20.7](https://www.postgresql.org/docs/current/runtime-config-query.html#RUNTIME-CONFIG-QUERY-ENABLE).1). Por ejemplo, apagando los escaneos secuenciales (`enable_seqscan`) y se une a lazo anidado (`enable_nestloop`), que son los planes más básicos, obligará al sistema a utilizar un plan  diferente. Si el sistema todavía elige un escaneo secuencial o un bucle  anidado, entonces probablemente hay una razón más fundamental por la que el índice no se está utilizando; por ejemplo, la condición de consulta  no coincide con el índice. (Qué tipo de consulta puede utilizar qué tipo de índice se explica en las secciones anteriores.)

- Si el uso del índice de fuerza utiliza el índice, entonces  hay dos posibilidades: O el sistema es correcto y el uso del índice no  es apropiado, o las estimaciones de costos de los planes de consulta no  reflejan la realidad. Así que deberías tiempo tu consulta con y sin  índices. El  `EXPLAIN ANALYZE`El comando puede ser útil aquí.

- Si resulta que las estimaciones de costos son erróneas, hay,  una vez más, dos posibilidades. El costo total se calcula con respecto a los costos por fímba de cada nodo plan veces la estimación de  selectividad del nodo del plan. Los costes estimados para los nodos del  plan pueden ajustarse a través de parámetros de tiempo de ejecución  (descritos en [la sección 20.7.](https://www.postgresql.org/docs/current/runtime-config-query.html#RUNTIME-CONFIG-QUERY-CONSTANTS)2). Una estimación de selectividad inexacta se debe a la insuficiencia de  estadísticas. Podría ser posible mejorar esto sintonando los parámetros  de reunión de estadísticas (véase [ALTER TABLE](https://www.postgresql.org/docs/current/sql-altertable.html)).

  Si no tiene éxito en ajustar los costos para ser más  apropiado, entonces es posible que tenga que recurrir a forzar el uso  del índice explícitamente. También es posible que desee ponerse en  contacto con los desarrolladores de PostgreSQL para examinar el problema.