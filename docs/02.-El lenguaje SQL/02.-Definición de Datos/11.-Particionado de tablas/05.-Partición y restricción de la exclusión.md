*La exclusión de restricción* es una técnica de optimización de consultas similar a la poda de  partición. Si bien se utiliza principalmente para la partición  implementada utilizando el método de herencia heredado, se puede  utilizar para otros fines, incluso con partición declarativa.

La exclusión de restricción funciona de una manera muy similar a la poda de la partición, excepto que utiliza la de cada tabla  `CHECK`restricciones que le dan su nombre, mientras que la poda de partición utiliza los  límites de partición de la tabla, que existen sólo en el caso de la  partición declarativa. Otra diferencia es que la exclusión de  restricción sólo se aplica en el tiempo del plan; no hay ningún intento  de eliminar las particiones en el momento de la ejecución.

El hecho de que la exclusión de restricción utiliza  `CHECK`restricciones, lo que hace que sea lento en comparación con la poda de la partición, a veces se pueden utilizar como una ventaja: porque las restricciones se  pueden definir incluso en tablas de partición declarativamente, además  de sus límites internos de la partición, la exclusión de restricciones  puede ser capaz de eliminación adicional del plan de consulta.

La fijación por defecto (y recomendada) de [la restricción.](https://www.postgresql.org/docs/current/runtime-config-query.html#GUC-CONSTRAINT-EXCLUSION)  `on`ni `off`, pero un ajuste intermedio llamado `partition`, lo que hace que la técnica se aplique únicamente a las consultas que  probablemente estén trabajando en tablas divididas en herencia. El  `on`el establecimiento hace que el planificador examine  `CHECK`limitaciones en todas las consultas, incluso simples que es poco probable que se beneficien.

Las siguientes advertencias se aplican a la exclusión de las restricciones:

- La exclusión de restricción sólo se aplica durante la  planificación de la consulta, a diferencia de la poda de partición, que  también se puede aplicar durante la ejecución de la consulta.
- La exclusión descarriada sólo funciona cuando la consulta  `WHERE`la cláusula contiene constantes (o parámetros suministrados externamente). Por ejemplo, una comparación con una función no inmutable, tales como  `CURRENT_TIMESTAMP`no se puede optimizar, ya que el planificador no puede saber en qué tabla  infantil el valor de la función podría caer en el tiempo de ejecución.
- Mantenga las restricciones de partición simples, de lo  contrario el planificador puede no ser capaz de probar que las tablas  infantiles podrían no necesitar ser visitadas. Utilíce condiciones de  igualdad simples para la partición de listas, o pruebas de rango simples para la partición de rango, como se ilustra en los ejemplos anteriores. Una buena regla general es que las restricciones de partición deben  contener sólo comparaciones de la columna de partición (s) a las  constantes utilizando operadores indexables de B-tree, porque sólo se  permiten columnas indexables B-tree en la tecla de partición.
- Todas las limitaciones de todos los hijos de la mesa matriz se examinan durante la exclusión de las restricciones, por lo que es  probable que un gran número de niños aumente considerablemente el tiempo de planificación de consultas. Así que la partición basada en la  herencia heredada funcionará bien con hasta tal vez cien mesas  infantiles; no trates de usar muchos miles de niños.